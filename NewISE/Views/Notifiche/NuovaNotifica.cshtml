@model NewISE.Models.DBModel.NotificheModel
@using NewISE.Models.DBModel;
@using System.IO;
<script src="~/Scripts/ckeditor/ckeditor.js"></script>
<script type="text/javascript" src="~/scripts/ckeditor/adapters/jquery.js"></script>
@*<script src="~/Scripts/jquery-1.8.2.min.js"></script>*@
@*<script src="~/Scripts/ckfinder/ckfinder.js"></script>*@
@{
    decimal idMittenteLogato = (decimal)ViewBag.idMittenteLogato;
    var errori = ViewData.ModelState;
}

@using (Ajax.BeginForm("InserisciNuovaNotifica", "Notifiche",new AjaxOptions { HttpMethod = "POST", UpdateTargetId = "divPanelNotifiche", OnFailure = "ErroreElaborazioneAjax" }, new { id = "formNuovaNotifica" }))
{
    @Html.AntiForgeryToken()
    <div class="form-horizontal">
        <hr />
        <input type="hidden" id="idMittente" name="idMittente" value="@idMittenteLogato.ToString()"/>
        <div class="row">
            <div class="col-xs-offset-2 col-xs-10">
                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            </div>
        </div>
            <div class="form-group" style="position:relative;z-index:9">
                <div id="divCombo1" ass="col-md-10" >
                    @Html.Label("lblListDestinatari", "Destinatari : ", new { @class = "control-label" })
                    <div>
                        @Html.DropDownList("lDestinatari", ViewBag.ListaDestinatari as IEnumerable<SelectListItem>
               , new { @class = "form-control js-example-tokenizer", multiple = "multiple", @onchange = "PrelevaPVListaDestinatari();", @onClick = "PrelevaPVListaDestinatari();" })
                    </div>
                    <div id="vai1" style="display:none; " class="text-danger">
                        @Html.Label("lblvai1", "Email presente in Cc")
                    </div>
                    <div id="vaiDest" style="display:none; " class="text-danger">
                        @Html.Label("lblDest", "Destinatario obbligatorio")
                    </div>
                </div>
                
                <div id="divCombo2" ass="col-md-10" >
                    @Html.Label("lblListDestinatari", "Cc : ", new { @class = "control-label" })
                    <div>
                        @Html.DropDownList("toCc", ViewBag.ListaCc as IEnumerable<SelectListItem>
               , new { @class = "form-control js-example-tokenizer", multiple = "multiple", @onchange = "PrelevaPVListaCC();", @onClick = "PrelevaPVListaDestinatari();" })
                    </div>
                    <div id="vai2" style="display:none; " class="text-danger">
                        @Html.Label("lblvai2", "Email presente in Destinatari")                                            
                    </div> 
                </div>
                @Html.Label("lblLivelloDestinatari", "Oggetto : ", new { @class = "control-label" })
                    <div>
                        @Html.Editor("Oggetto", "Oggetto", new { htmlAttributes = new { @class = "form-control" } })                       
                    </div>
                    <div id="vaiOgg" style="display:none; " class="text-danger">
                        @Html.Label("lblOgg", "Oggetto mancante")
                    </div> 
            </div>

        <div class="form-group"  >
            @*<div class="text-right" ><input id="idBtnAllegato" style="height:40px;width:100px;vertical-align:central" type="button"  class="btn btn-danger"
                   value="Allega PDF" onclick="AllegaPDF();" /></div>*@
            @*<div>
                <span>Select File:</span>
                <input type="file" name="postedFile" />
                <input type="submit" value="Upload" />
            </div>*@
            @*<div style="padding-left: 15px; padding-right: 10px;">
                <input id="files" name="files[]" type="file" multiple class="file-loading">
                <div id="divError" class="text-center text-error text-danger">
                </div>
            </div>*@
            <div ass="col-md-10">
                @*@Html.TextBoxFor(model=>model.corpoMessaggio, new { @id = "corpoMessaggio", @class = "ckeditor"})*@ 
                <textarea id="corpoMessaggio" name="corpoMessaggio"></textarea>
                @Html.ValidationMessageFor(model => model.corpoMessaggio, "", new { @class = "text-danger" })
                <script type="text/javascript">
                   @*CKEDITOR.replace(@Html.Id("corpoMessaggio"));*@
                    //CKEDITOR.replace("corpoMessaggio");
                    @*CKEDITOR.replace("#@Html.IdFor(m=>m.corpoMessaggio)").val());*@
                    //var textarea = document.body.appendChild(document.createElement('textarea'));
                    //textarea.id = "corpoMessaggio"; textarea.name = "corpoMessaggio";
                    //CKEDITOR.replace(textarea);
                    CKEDITOR.config.readOnly = false;
                    //for (instance in CKEDITOR.instances) {
                    //    CKEDITOR.instances[instance].updateElement();
                    //}
                </script> @*@Html.EditorFor(model => model.Description, new { htmlAttributes = new { @class = "form-control" } }) @Html.ValidationMessageFor(model => model.Description, "", new { @class = "text-danger" })*@
            </div>
            <div id="vaiCorpoMess" style="display:none; " class="text-danger">
                @Html.Label("lblvai1", "Messaggio vuoto")
            </div> 
        </div>

        <div class="form-group">
            @*<div class="col-md-offset-2 col-md-10" >*@
            <div class="row" style="text-align:left">
                <div class="col-xs-2"> 
                    <input type="submit" value="Invia" class="btn btn-default" />
                </div>
                @*<input type="button" value="Invia" class="btn btn-default" onclick="Register();" />*@
                <div class="col-xs-10" style="text-align:right">
                    <input id="idBtnAllegato" style="height:33px;width:100px;vertical-align:central" type="button" class="btn btn-danger"
                           value="Allega PDF" onclick="AllegaPDF();" />
                </div>
            </div>
            <div>
                <br /><a href="#" onclick="TornaElencoIb();">Torna all'elenco delle Notifiche</a>
            </div>
        </div>
    </div>
}

<div class="modal fade" id="myModalErrorModel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title alert alert-warning text-warning" id="myModalLabel">Attenzione!!!</h4>
            </div>
            <div class="modal-body alert alert-warning text-warning">
                <p id="msgModalWarning" class="text-warning">
                    @Html.ValidationSummary(false, "", new { @class = "text-danger" })
                </p>
            </div>
            <div class="modal-footer">
                <button id="btProcedi" type="button" class="btn btn-warning" data-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="~/Scripts/Notifiche/Operazione.js"></script>

<script type="text/javascript">

    $(function () {
        CKEDITOR.replace("corpoMessaggio", { customConfig: "~/Scripts/ckeditor/config.js" });
    })
</script>