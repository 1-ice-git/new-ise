
<link href="~/Content/css/AttivitaTrasferimento.css" rel="stylesheet" />


@{
    decimal idTrasferimento = Convert.ToDecimal(ViewBag.idTrasferimento);
}

<table class="table table-striped">
    <thead>
        <tr>
            <th>
                Attività
            </th>
            <th>
                Richiesta
            </th>
            <th>
                Stato Richiesta
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <th>
                @Ajax.ActionLink("Richiesta Maggiorazioni Familiari", "MaggiorazioniFamiliari", "MaggiorazioniFamiliari", new { idTrasferimento = idTrasferimento }, new AjaxOptions { UpdateTargetId = "divOperazioniAttivitaTrasf", InsertionMode = InsertionMode.Replace, HttpMethod = "POST", OnFailure = "ErroreElaborazioneAjax(this);" }, new { @id = "chkMagFam" })
            </th>
            <td>
                <div class="material-switch pull-right">
                    <input id="chkMagFamiliariR" name="chkMagFamiliariR" type="checkbox" onclick="return false;" />
                    <label for="chkMagFamiliariR" class="label-success"></label>
                </div>
            </td>
            <td>
                <div class="material-switch pull-right">
                    <input id="chkMagFamiliariSR" name="chkMagFamiliariSR" type="checkbox" onclick="return false;" />
                    <label for="chkMagFamiliariSR" class="label-success"></label>
                </div>
            </td>
        </tr>
        <tr>
            <th>
                @Ajax.ActionLink("Pratiche passaporto", "Passaporti", "PratichePassaporto", new { idTrasferimento = idTrasferimento }, new AjaxOptions { UpdateTargetId = "divOperazioniAttivitaTrasf", InsertionMode = InsertionMode.Replace, HttpMethod = "POST", OnFailure = "ErroreElaborazioneAjax(this);" }, new { @id = "linkPratichePassaporto" })
            </th>
            <td>
                <div class="material-switch pull-right">
                    <input id="chkPratichePassaportoR" name="chkPratichePassaportoR" type="checkbox" onclick="return false;" />
                    <label for="chkPratichePassaportoR" class="label-success"></label>
                </div>
            </td>
            <td>
                <div class="material-switch pull-right">
                    <input id="chkPratichePassaportoSR" name="chkPratichePassaportoSR" type="checkbox" onclick="return false;" />
                    <label for="chkPratichePassaportoSR" class="label-success"></label>
                </div>
            </td>
        </tr>
        <tr>
            <th>
                @Ajax.ActionLink("Richiesta Titoli di Viaggio", "TitoliViaggio", "TitoliViaggio", new { idTrasferimento = idTrasferimento }, new AjaxOptions { UpdateTargetId = "divOperazioniAttivitaTrasf", InsertionMode = InsertionMode.Replace, HttpMethod = "POST", OnFailure = "ErroreElaborazioneAjax(this);" }, new { @id = "linkTitoliViaggio" })

            </th>
            <td>
                <div class="material-switch pull-right">
                    <input id="chkTitoliViaggioR" name="chkTitoliViaggioR" type="checkbox" onclick="return false;" />
                    <label for="chkTitoliViaggioR" class="label-success"></label>
                </div>
            </td>
            <td>
                <div class="material-switch pull-right">
                    <input id="chkTitoliViaggioSR" name="chkTitoliViaggioSR" type="checkbox" onclick="return false;" />
                    <label for="chkTitoliViaggioSR" class="label-success"></label>
                </div>
            </td>
        </tr>
        <tr>
            <th>
                Richiesta Anticipi
            </th>
            <td>
                <div class="material-switch pull-right">
                    <input id="chkAnticipiR" name="chkAnticipiR" type="checkbox" onclick="return false;" />
                    <label for="chkAnticipiR" class="label-success"></label>
                </div>
            </td>
            <td>
                <div class="material-switch pull-right">
                    <input id="chkAnticipiSR" name="chkAnticipiSR" type="checkbox" onclick="return false;" />
                    <label for="chkAnticipiSR" class="label-success"></label>
                </div>
            </td>
        </tr>
        <tr>
            <th>
                Richiesta Trasporto Effetti
            </th>
            <td>
                <div class="material-switch pull-right">
                    <input id="chkTrasportoEffettiR" name="chkTrasportoEffettiR" type="checkbox" onclick="return false;" />
                    <label for="chkTrasportoEffettiR" class="label-success"></label>
                </div>
            </td>
            <td>
                <div class="material-switch pull-right">
                    <input id="chkTrasportoEffettiSR" name="chkTrasportoEffettiSR" type="checkbox" onclick="return false;" />
                    <label for="chkTrasportoEffettiSR" class="label-success"></label>
                </div>
            </td>
        </tr>
        <tr>
            <th>
                Richiesta Maggiorazione Abitazione
            </th>
            <td>
                <div class="material-switch pull-right">
                    <input id="chkMABR" name="chkMABR" type="checkbox" onclick="return false;" />
                    <label for="chkMABR" class="label-success"></label>
                </div>
            </td>
            <td>
                <div class="material-switch pull-right">
                    <input id="chkMABSR" name="chkMABSR" type="checkbox" onclick="return false;" />
                    <label for="chkMABSR" class="label-success"></label>
                </div>
            </td>
        </tr>
    </tbody>
</table>
<div class="text-center" style="padding-bottom: 5px;">
    <button class="btn btn-default btn-sm disabled" disabled id="btAttivaTrsf">
        <i class="fa fa-2x fa-envelope" aria-hidden="true"></i>
        Attiva Trasferimento
    </button>

    <button class="btn btn-default btn-sm disabled" disabled id="btAnnullaTrasf">
        <i class="fa fa-2x fa-envelope" aria-hidden="true"></i>
        Annulla Trasferimento
    </button>
</div>

<script type="text/javascript">

    function AggiornaInfoTrasferimento() {
        var rotta = "/Trasferimento/InfoTrasferimento";
        var idTrasf = parseInt('@idTrasferimento');

        $.ajax({
            type: "POST",
            url: rotta,
            data: { idTrasferimento: idTrasf },
            dataType: 'html',
            beforeSend: function () {
                //debugger;
                //VerificaAutenticazione();
                //$("#DialogNewDoc").dialog("destroy");
                //$("#divEffettoLoadAutNoDoc").show("slow");
                //$("#ContenitoreDipendentiGepe").empty();
            },
            success: function (result) {
                //debugger;
                //$("#divEffettoLoadAutNoDoc").hide("slow");
                $("#ContenitoreDatiTrasf").empty();
                $("#ContenitoreDatiTrasf").html(result);

                //RicercaDocumenti();

            },
            complete: function () {

            },
            error: function (jqXHR, textStatus, errorThrow) {
                //debugger;
                var msg = errorThrow.err;
                AlertDialog(msg);
            }

        });
    }


    GestioneAttivitaTrasferimento();
    ///Tale funzione gestisce l'abilitazione delle checkbox per la gestione delle attività di trasferimento e la sequenza di abilitazione dei link.
    function GestioneAttivitaTrasferimento() {
        //debugger;
        var rotta = "/Trasferimento/GestioneAttivitaTrasferimento";
        var idTrasf = parseInt('@idTrasferimento');

        $.ajax({
            type: "POST",
            url: rotta,
            data: { idTrasferimento: idTrasf },
            dataType: 'json',
            beforeSend: function () {
                //debugger;
                //VerificaAutenticazione();
                //$("#DialogNewDoc").dialog("destroy");
                //$("#divEffettoLoadAutNoDoc").show("slow");
            },
            success: function (result) {
                //debugger;

                if (result.err == "") {
                    var admin = result.admin;
                    var richiestaMF = result.richiestaMF;
                    var attivazioneMF = result.attivazioneMF;
                    var richiestaPP = result.richiestaPP;
                    var conclusePP = result.conclusePP;
                    var richiesteTV = result.richiesteTV;
                    var concluseTV = result.concluseTV;


                    if (richiestaMF == true) {
                        $("#chkMagFamiliariR").each(function () { this.checked = true; });
                        if (attivazioneMF == true) {
                            $("#chkMagFamiliariSR").each(function () { this.checked = true; });
                            EnableDisableLinkPassaporto(true);
                        } else {
                            $("#chkMagFamiliariSR").each(function () { this.checked = false; });
                            EnableDisableLinkPassaporto(false);
                        }
                    } else {
                        $("#chkMagFamiliariR").each(function () { this.checked = false; });
                        $("#chkMagFamiliariSR").each(function () { this.checked = false; });

                        EnableDisableLinkPassaporto(false);
                    }

                    if (richiestaPP == true) {
                        $("#chkPratichePassaportoR").each(function () { this.checked = true; });
                        if (conclusePP == true) {
                            $("#chkPratichePassaportoSR").each(function () { this.checked = true; });
                            EnableDisableLinkTitoliViaggio(true);
                        } else {
                            $("#chkPratichePassaportoSR").each(function () { this.checked = false; });
                            EnableDisableLinkTitoliViaggio(false);
                        }
                    } else {
                        $("#chkPratichePassaportoR").each(function () { this.checked = false; });
                        $("#chkPratichePassaportoSR").each(function () { this.checked = false; });
                        EnableDisableLinkTitoliViaggio(false);
                    }


                    //chkTitoliViaggioR
                    if (richiesteTV == true) {
                        $("#chkTitoliViaggioR").each(function () { this.checked = true; });
                        if (concluseTV == true) {
                            $("#chkTitoliViaggioSR").each(function () { this.checked = true; });
                        } else {
                            $("#chkTitoliViaggioSR").each(function () { this.checked = false; });
                        }
                    } else {
                        $("#chkTitoliViaggioR").each(function () { this.checked = false; });
                        $("#chkTitoliViaggioSR").each(function () { this.checked = false; });
                    }


                    AggiornaInfoTrasferimento();

                } else {
                    ErroreElaborazioneAjax(result.err);
                }

            },
            complete: function () {

            },
            error: function (jqXHR, textStatus, errorThrow) {
                //debugger;
                var msg = errorThrow.err;
                ErroreElaborazioneAjax(msg);
            }

        });
    }

    function EnableDisableLinkPassaporto(abilitato) {
        //debugger;
        if (abilitato == true) {
            $("#linkPratichePassaporto").removeAttr("disabled");
            $("#linkPratichePassaporto").removeClass("disableLink");
        } else {
            //disableLink
            $("#linkPratichePassaporto").attr("disabled", "disabled");
            $("#linkPratichePassaporto").addClass("disableLink");
        }
    }

    function EnableDisableLinkTitoliViaggio(abilitato) {
        //debugger;
        if (abilitato == true) {
            $("#linkTitoliViaggio").removeAttr("disabled");
            $("#linkTitoliViaggio").removeClass("disableLink");
        } else {
            //disableLink
            $("#linkTitoliViaggio").attr("disabled", "disabled");
            $("#linkTitoliViaggio").addClass("disableLink");
        }
    }

</script>