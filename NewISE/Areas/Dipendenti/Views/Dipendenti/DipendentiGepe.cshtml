@model NewISE.Models.ModelRest.DipendenteRest

@{
    bool admin = Convert.ToBoolean(ViewBag.Amministratore);
    string matricola = ViewBag.Matricola;
}

<div id="divControlliDipendenti">
    <div class="form-horizontal">
        <div class="form-group">
            @Html.Label("lblMatricola", "Matricola", new { @class = "control-label col-xs-3" })
            <div id="divCombo" class="col-xs-9">
                <div class="select2-container select2-container--classic">
                    @Html.DropDownList("matricola", ViewBag.ListDipendentiGepeMatricola as IEnumerable<SelectListItem>, new { @class = "form-control select2 select2-select", @onchange = "FiltraDipendente(this.value);" })
                </div>
            </div>
        </div>
        <div class="form-group">
            @Html.Label("lblNominativo", "Nominativo", new { @class = "control-label col-xs-3" })
            <div id="divCombo2" class="col-xs-9">
                <div class="select2-container select2-container--classic">
                    @Html.DropDownList("matricola", ViewBag.ListDipendentiGepeNominativo as IEnumerable<SelectListItem>, new { @id = "listNominativo", @class = "form-control select2 select2-select", @onchange = "FiltraDipendente(this.value);" })
                </div>
            </div>
        </div>
        <div class="form-group">
            <label for="dataAssunzione" class="col-xs-3 control-label">Data assunz.</label>
            <div class="col-xs-9">
                <input id="dataAssunzione" name="dataAssunzione" type="datetime" value="@Model.dataAssunzione.ToShortDateString()" class="form-control" readonly />
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.livello.livello, htmlAttributes: new { @class = "control-label col-xs-3" })
            <div class="col-xs-9">
                <input id="livello" name="livello" type="text" value="@Model.livello.livello" class="form-control" readonly />
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.cdc.cdc, htmlAttributes: new { @class = "control-label col-xs-3" })
            <div class="col-xs-9">
                <input id="cdc" name="cdc" type="text" value="@Model.cdc.cdc" class="form-control" readonly />
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

    $("#hMatricola").val('@matricola');

    InfoTrasferimento('@matricola');

    $("#matricola").select2({
        placeholder: "Seleziona la matricola",
        allowClear: true,
        language: "it",
        width: '100'

    });
    $("#listNominativo").select2({
        placeholder: "Seleziona il nominativo",
        allowClear: true,
        language: "it",
        width: '300'

    });

    function FiltraDipendente(matricola) {
        //debugger;
        var rotta = "/Dipendenti/Dipendenti/DipendentiGepe";
        //var matricola = $("#matricola").select2('val');

        if (matricola != "") {
            $.ajax({
                type: "POST",
                url: rotta,
                data: { matricola: matricola },
                dataType: 'html',
                beforeSend: function () {
                    //debugger;
                    //VerificaAutenticazione();
                    //$("#DialogNewDoc").dialog("destroy");
                    //$("#divEffettoLoadAutNoDoc").show("slow");
                    //$("#ContenitoreDipendentiGepe").empty();
                },
                success: function (result) {
                    //debugger;
                    //$("#divEffettoLoadAutNoDoc").hide("slow");
                    $("#ContenitoreDipendentiGepe").empty();
                    $("#ContenitoreDipendentiGepe").html(result);

                    InfoTrasferimento(matricola);

                },
                complete: function () {
                    //$("#divEffettoLoadAutNoDoc").hide("slow");
                    //                $("#Centro").getNiceScroll().resize();
                },
                error: function (jqXHR, textStatus, errorThrow) {
                    //debugger;
                    var msg = errorThrow.err;
                    AlertDialog(msg);
                }

            });
        }
    }

    function InfoTrasferimento(matricola) {
        //debugger;
        var rotta = "/Dipendenti/Dipendenti/InfoTrasferimento";
        if (matricola != "") {
            $.ajax({
                type: "POST",
                url: rotta,
                data: { matricola: matricola },
                dataType: 'html',
                beforeSend: function () {
                    //debugger;
                    //VerificaAutenticazione();
                    //$("#DialogNewDoc").dialog("destroy");
                    //$("#divEffettoLoadAutNoDoc").show("slow");
                    //$("#ContenitoreDipendentiGepe").empty();
                },
                success: function (result) {
                    //debugger;
                    //$("#divEffettoLoadAutNoDoc").hide("slow");
                    $("#ContenitoreDatiTrasf").empty();
                    $("#ContenitoreDatiTrasf").html(result);

                    //RicercaDocumenti();

                },
                complete: function () {
                    //$("#divEffettoLoadAutNoDoc").hide("slow");
                    //                $("#Centro").getNiceScroll().resize();
                },
                error: function (jqXHR, textStatus, errorThrow) {
                    //debugger;
                    var msg = errorThrow.err;
                    AlertDialog(msg);
                }

            });
        }
    }
</script>